
# Методы Оптимизации. Даниил Меркулов. Условия Оптимальности, ККТ

## Extreme value (Weierstrass) theorem
Пусть $S \subset \mathbb{R}^n$ - компактное множество и пусть $f(x)$ непрерывная функция на $S$. 
Тогда точка глобального минимума функции $f (x)$ на $S$ существует.

![](../files/goodnews.png)

## Optimality Conditions
### Общая задача оптимизации

$$
f(x) \to \min\limits_{x \in S}
$$

Будем говорить, что задача имеет решение, если множество таких $x^* \in S$, что в них достигается минимум или инфимум данной функции **не пусто**

#### Критерий оптимальности
Пусть $f(x)$ определена на множестве $S \subseteq \mathbb{R}^n$.
Тогда 
* если $x^*$ точка минимума $f(x)$ на $S$, то $\partial_S f(x^*) \neq \emptyset$ и $0 \in \partial_S f(x^*)$
* если для некоторой точки $x^* \in S$ существует субдифференциал $\partial_S f(x^*)$ и $0 \in \partial_S f(x^*)$, то $x^*$ - точка минимума $f(x)$ на $S$.

Problemes в том, что подсчет субдифференциала может быть еще сложнее, чем подсчет градмента. А часто у функций субдифференциала вообще нет во многих точках.

#### Общая схема:

Рассмотрим задачи:
* безусловной минимизации
* задачу с ограничениями типа равенств 
* задачу с огранчениями типа неравенств
* задачу с с ограничениями типа равенств и неравенств

### Задача БМ
$$
f(x) \to \min\limits_{x \in \mathbb{R}^n}
$$

#### Достаточное условие
Пусть $f(x)$ дважды дифференцируема на $\mathbb{R}^n$ и $x^*$ такая что $\nabla f(x^*) = 0$. Тогда если 
$$
\nabla^2 f(x^*) \succ 0,
$$
то $x^*$ точка строгого локального минимума $f(x)$ на $\mathbb{R}^n$.  

#### Критерий оптимальности выпуклой задачи
* Пусть $f(x)$ выпуклая функция на $\mathbb{R}^n$. Тогда точка $x^*$ - решение задачи безусловной минимизации $\Leftrightarrow$ 
$$
0 \in \partial f(x^*).
$$
* Пусть $f(x)$ выпуклая дифференцируемая функция на $\mathbb{R}^n$. Тогда точка $x^*$ - решение задачи безусловной минимизации $\Leftrightarrow$ 
$$
0 = \nabla f(x^*).
$$

### Задачи с ограничениями типа равенств
#### Простой пример
[Ссылочка](http://www.csc.kth.se/utbildning/kth/kurser/DD3364/Lectures/KKT.pdf) на оригинал
$$
f(x) = x_1 + x_2 \;\;\;\; h(x) = x_1^2 + x_2^2 - 2
$$

$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & h(x) = 0
\end{split}
$$

![](../files/KKT_p009.png)

![](../files/KKT_p010.png)

![](../files/KKT_p011.png)

![](../files/KKT_p012.png)

![](../files/KKT_p013.png)

![](../files/KKT_p014.png)

![](../files/KKT_p015.png)

![](../files/KKT_p016.png)

![](../files/KKT_p017.png)

Итого, имеем: чтобы двигаясь из $x_F$ по бюджетному множеству в сторону уменьшения функции, нам необходимо гарантировать два условия:
$$
\langle \delta x, \nabla h(x_F) \rangle = 0
$$

$$
\langle \delta x, - \nabla f(x_F) \rangle > 0
$$

Пусть в процессе такого движения мы пришли в точку, где 
$$
\nabla f(x) = \mu \nabla h(x)
$$

$$
\langle  \delta x, - \nabla f(x)\rangle = -\langle  \delta x, \mu\nabla h(x)\rangle = 0  
$$
Тогда мы пришли в точку бюджетного множества, двигаясь из которой не получится уменьшить нашу функцию. Это и есть локальный минимум в ограниченной задаче:)

![](../files/KKT_p021.png)

Так давайте определим функцию Лагранжа (исключительно для удобства):
$$
L(x, \mu) = f(x) + \mu h(x)
$$

Тогда точка $x^*$ - локальный минимум описанной выше задачи, тогда и только тогда, когда:
$$
\begin{split}
& \nabla_x L(x^*, \mu^*) = 0 \text{ то, что мы написали выше}\\
& \nabla_\mu L(x^*, \mu^*) = 0 \text{ условие нахождения в бюджетном множестве}\\
& \langle y , \nabla^2_{xx} L(x^*, \mu^*) y \rangle \geq 0, \;\;\; \forall y \in \mathbb{R}^n : \nabla h(x^*)^\top y = 0
\end{split}
$$

Сразу же заметим, что $L(x^*, \mu^*) = f(x^*)$

#### Общая формулировка
$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & h_i(x) = 0, \; i = 1,\ldots, m 
\end{split}
$$

#### Общее решение:
$$
L(x, \mu) = f(x) + \sum\limits_{i=1}^m\mu_i g_i(x) = f(x) + \mu^\top g(x)
$$

Пусть $f(x)$ и $h_i(x)$ дважды дифференцируемы в точке $x^*$ и непрерывно дифференцируемы в некоторой окрестности $x^*$. Условия локального минимума для $x \in \mathbb{R}^n, \mu \in \mathbb{R}^m $ запишутся как

$$
\begin{split}
& \nabla_x L(x^*, \mu^*) = 0 \\
& \nabla_\mu L(x^*, \mu^*) = 0 \\
& \langle y , \nabla^2_{xx} L(x^*, \mu^*) y \rangle \geq 0, \;\;\; \forall y \in \mathbb{R}^n : \nabla h(x^*)^\top y = 0
\end{split}
$$

В заисимости от поведения гессиана критические точки могут иметь разный характер

![](../files/critical.png)

### Задачи с ограничениями типа неравенств

#### Простой пример
$$
f(x) = x_1^2 + x_2^2 \;\;\;\; g(x) = x_1^2 + x_2^2 - 1
$$

$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & g(x) \leq 0
\end{split}
$$

![](../files/KKT_p027.png)

![](../files/KKT_p028.png)

![](../files/KKT_p029.png)

![](../files/KKT_p030.png)

Таким образом, если ограничения типа неравенств неактивны в задаче БМ, то можно не парится и выписывать решение задачи БМ. Однако, так бывает не всегда:) Рассмотрим второй игрушечный пример
$$
f(x) = (x_1 - 1.1)^2 + (x_2 - 1.1)^2 \;\;\;\; g(x) = x_1^2 + x_2^2 - 1
$$

$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & g(x) \leq 0
\end{split}
$$

![](../files/KKT_p033.png)

![](../files/KKT_p034.png)

![](../files/KKT_p035.png)

![](../files/KKT_p036.png)

![](../files/KKT_p037.png)

![](../files/KKT_p038.png)

![](../files/KKT_p039.png)

![](../files/KKT_p040.png)

Итого, мы имеем проблему:

$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & g(x) \leq 0
\end{split}
$$

И два возможных случая:

1.  $$ \begin{split}
    & g(x^*) < 0 \\
    & \nabla f(x^*) = 0 \\
    & \nabla^2 f(x^*) > 0
    \end{split}$$
    
2. $$ \begin{split}
    & g(x^*) = 0 \\
    & - \nabla f(x^*) = \lambda g(x^*), \;\; \lambda > 0 \\
    & \langle y , \nabla^2_{xx} L(x^*, \lambda^*) y \rangle \geq 0, \;\;\; \forall y \in \mathbb{R}^n : \nabla g(x^*)^\top y = 0
    \end{split}$$
   

Объединяя два возможных случая, можно записать общие условия для задачи:
$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n} \\
\text{s.t. } & g(x) \leq 0 \\
&
\end{split}
$$

Определим функцию Лагранжа:
$$
L (x, \lambda) = f(x) + \lambda g(x)
$$

Тогда точка $x^*$ - локальный минимум описанной выше задачи, тогда и только тогда, когда:
$$ \begin{split}
    & (1) \; \nabla_x L (x^*, \lambda^*) = 0 \\
    & (2) \; \lambda^* \geq 0 \\
    & (3) \; \lambda^* g(x^*) = 0 \\
    & (4) \; g(x^*) \leq 0\\
    & (5) \; \langle y , \nabla^2_{xx} L(x^*, \lambda^*) y \rangle \geq 0, \;\;\; \forall y \in \mathbb{R}^n : \nabla g(x^*)^\top y = 0
    \end{split}$$

Сразу же заметим, что $L(x^*, \lambda^*) = f(x^*)$. Условия $\lambda^* > 0 , (1), (4)$ при этом реализуют первый сценарий, а условия $\lambda^* > 0 , (1), (3)$ - второй.

#### Общая формулировка
$$
\begin{split}
& f(x) \to \min\limits_{x \in \mathbb{R}^n}\\
\text{s.t. } & g_i(x) = 0, \; i = 1,\ldots,m\\
& h_j(x) \leq 0, \; j = 1,\ldots, p
\end{split}
$$
Данная формулировка представляет собой общую задачу математического программирования.

#### Решение: регулярная функция Лагранжа
$$
L(x, \lambda, \mu) = f(x) + \sum\limits_{i=1}^m\mu_i g_i(x) + \sum\limits_{j=1}^p \lambda_j h_j(x)
$$

#### Условия Каруша  Куна Таккера:
Пусть $x^*$ решение задачи математического программирования, и функции $f, h_j, g_i$ дифференцирумы. 
Тогда найдутся такие $\mu^*$ и $\lambda^*$, что выполнены следующие условия:

* $\nabla_x L(x^*, \mu^*, \lambda^*) = 0$
* $\nabla_\mu L(x^*, \mu^*, \lambda^*) = 0$
* $ \lambda^*_j \geq 0$
* $\lambda^*_j h_j(x^*) = 0$
* $h_j(x^*) \leq 0$

В выпуклом случае эти условия являются достаточными!

![](../files/sweet.png)

#### Достаточные условия первого порядка
Если для стационарной точки $(x^*, \mu^*, \lambda^*)$ число активных неравенств $|J|$ такое что $n = l + |J|$ и $\lambda_j > 0, \; j \in J$, то эта точка является точкой минимума.
#### Достаточные условия второго порядка
Если в задаче математического программирования число активных ограничений меньше размерности задачи, то точка $x^*$ яляется решением задачи, если выполнены условия
$$
z^{T}\nabla_{xx}^2 L(x^*)z > 0
$$
для 
* $z \neq 0$ и $\nabla h^{T}_i(x^*)z = 0$
* при $j \in J$ и $\lambda_j > 0$, $\nabla g^{T}_j(x^*) z = 0$
* при $j \in J$ и $\lambda_j = 0$, $\nabla g^{T}_j(x^*) z \leq 0$

## Примеры
### Пример 1  
![](../files/task.png)

### Пример 2 (безусловная минимизация)
![](../files/bm.png)

### Пример 3 (ограничения типа равенств)
![](../files/um.png)

### Пример 4 (ограничения типа неравенств)
![](../files/ner.png)

## Take home message
* Любой локальный минимум выпуклой задачи - глобальный
* В сильно выпуклой задаче локальный минимум единственный
* Условия Каруша Куна Таккера - прекрасный способ решать задачи математического программирования. В выпуклом случае он еще и дает гарантии.
